package projects

import (
	"github.com/gofiber/fiber/v2"
	"pentest-backend/database"
	"pentest-backend/database/models"
)

type ResultProgress struct {
	models.Progress
	models.Project
}

// Route: /user/progress
func HandleProjectsProgression(c *fiber.Ctx) error {
	var progresses []models.Progress
	var results []ResultProgress
	database.Client.Table("progress").Order("used_at ASC").Distinct("user_id", "project_id").Where(&models.Progress{UserID: c.Locals("user_id").(uint)}).Find(&progresses)

	for _, progress := range progresses {
		var project models.Project
		database.Client.Table("projects").Where(progress.ProjectID).First(&project)
		results = append(results, ResultProgress{progress, project})
	}

	return c.JSON(&results)
}
