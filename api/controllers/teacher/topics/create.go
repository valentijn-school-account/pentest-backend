package topics

import (
	"fmt"
	"github.com/gofiber/fiber/v2"
	uuid2 "github.com/savsgio/gotils/uuid"
	"net/http"
	"pentest-backend/database"
	"pentest-backend/database/models"
)

type ParamTopicCreation struct {
	Title string `json:"title"`
}

func CreateTopic(c *fiber.Ctx) error {
	var param ParamTopicCreation

	if err := c.BodyParser(&param); err != nil {
		return fiber.NewError(http.StatusUnprocessableEntity, fmt.Sprintf("Can't process data: %v", err))
	}

	if param.Title == "" {
		return fiber.NewError(http.StatusUnprocessableEntity, "Please provide a title")
	}

	var topic models.Topic

	uuid := uuid2.V4()
	topic = models.Topic{UUID: uuid, Name: param.Title}

	database.Client.Table("topics").Create(&topic)

	return c.JSON(&topic)
}
