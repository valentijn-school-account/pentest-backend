package classes

import (
	"fmt"
	"github.com/gofiber/fiber/v2"
	"net/http"
	"pentest-backend/database"
	"pentest-backend/database/models"
)

type ParamDeletionClass struct {
	Class string `json:"class"`
}

func HandleClassDeletion(c *fiber.Ctx) error {
	var param ParamDeletionClass

	if err := c.BodyParser(&param); err != nil {
		return fiber.NewError(http.StatusUnprocessableEntity, fmt.Sprintf("Can't process data: %v", err))
	}

	if param.Class == "" {
		return fiber.NewError(http.StatusUnprocessableEntity, "Please provide a class uuid")
	}

	var class models.Class

	database.Client.Table("classes").Where(&models.Class{UUID: param.Class}).First(&class)

	if class.ID == 0 {
		return fiber.NewError(http.StatusNotFound, "Class was not found.")
	}

	database.Client.Table("classes").Where("id", class.ID).Delete(&class)

	return c.SendStatus(http.StatusOK)
}
